<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">

  <!-- PACE Progress Bar START -->
  
    <script src="https://raw.githubusercontent.com/HubSpot/pace/v1.0.2/pace.min.js"></script>
    <link rel="stylesheet" href="https://github.com/HubSpot/pace/raw/master/themes/orange/pace-theme-flash.css">
  
  

  <!-- PACE Progress Bar START -->

  
  <title> profile python applications in azure app services		 | Azure OSS Developer Support</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="python">
  
  
  
  
  <meta name="description" content="Slow application performance issues tend to be challenging to troubleshoot regardless of the platform in which your application is running. This is due in great part to the sometimes random nature of">
<meta name="keywords" content="python">
<meta property="og:type" content="article">
<meta property="og:title" content=" Profile Python Applications in Azure App Services		">
<meta property="og:url" content="http://azureossd.github.io/profile-python-applications-in-azure-app-services/index.html">
<meta property="og:site_name" content="Azure OSS Developer Support">
<meta property="og:description" content="Slow application performance issues tend to be challenging to troubleshoot regardless of the platform in which your application is running. This is due in great part to the sometimes random nature of">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://prmadi.com/content/images/2017/06/Capture3.PNG">
<meta property="og:image" content="https://prmadi.com/content/images/2017/06/Capture4-1.PNG">
<meta property="og:image" content="https://prmadi.com/content/images/2017/06/profiler_output.PNG">
<meta property="og:image" content="https://prmadi.com/content/images/2017/06/profiler_output1.PNG">
<meta property="og:image" content="https://prmadi.com/content/images/2017/06/Capture5.PNG">
<meta property="og:image" content="https://prmadi.com/content/images/2017/06/Capture6.PNG">
<meta property="og:updated_time" content="2019-03-26T17:38:22.622Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content=" Profile Python Applications in Azure App Services		">
<meta name="twitter:description" content="Slow application performance issues tend to be challenging to troubleshoot regardless of the platform in which your application is running. This is due in great part to the sometimes random nature of">
<meta name="twitter:image" content="https://prmadi.com/content/images/2017/06/Capture3.PNG">
  
    <link rel="alternate" href="/atom.xml" title="Azure OSS Developer Support" type="application/atom+xml">
  
  <link rel="icon" href="/css/images/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="https://cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/hiero.css">
  <link rel="stylesheet" href="/css/glyphs.css">
  

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/my.css">
  <!-- Google Adsense -->
  
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
      (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-0123456789ABCDEFFFFFF",
          enable_page_level_ads: true
      });
  </script>
  
</head>
</html>
<script>
var themeMenus = {};

  themeMenus["/"] = "Home"; 

  themeMenus["/archives"] = "Archives"; 

</script>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  <header id="allheader" class="site-header" role="banner">
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="Azure OSS Developer Support" rel="home"> Azure OSS Developer Support </a>
            
          </h1>

          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>
            <div class="clearfix sf-menu">

              <ul id="main-nav" class="nmenu sf-js-enabled">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class href="/">Home</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class href="/archives">Archives</a> </li>
                    
              </ul>
            </div>
          </nav>


      </div>
  </div>
</header>


  <div id="originBgDiv" style="background: #fff; width: 100%;">

      <div style="max-height:600px; overflow: hidden;  display: flex; display: -webkit-flex; align-items: center;">
        <img id="originBg" width="100%" alt src>
      </div>

  </div>

  <script>
  function setAboutIMG(){
      var imgUrls = "css/images/pose.jpg,https://source.unsplash.com/collection/954550/1920x1080".split(",");
      var random = Math.floor((Math.random() * imgUrls.length ));
      if (imgUrls[random].startsWith('http') || imgUrls[random].indexOf('://') >= 0) {
        document.getElementById("originBg").src=imgUrls[random];
      } else {
        document.getElementById("originBg").src='/' + imgUrls[random];
      }
  }
  bgDiv=document.getElementById("originBgDiv");
  if(location.pathname.match('about')){
    setAboutIMG();
    bgDiv.style.display='block';
  }else{
    bgDiv.style.display='none';
  }
  </script>



  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-profile-python-applications-in-azure-app-services" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost">
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
       Profile Python Applications in Azure App Services		
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/profile-python-applications-in-azure-app-services/" class="article-date">
	  <time datetime="2017-09-01T18:15:27.000Z" itemprop="datePublished">September 1, 2017</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>Slow application performance issues tend to be challenging to troubleshoot regardless of the platform in which your application is running. This is due in great part to the sometimes random nature of these issues. These types of issues also often do not result in a specific error being logged.</p>
<p>If you think your Python application is running slow and takes more than few seconds to receive response. Below info may help you analyze where itâ€™s taking longer time and also checks for memory leaks If you are running Python App on Azure App Services(Windows). I would recommend to use HttpPlatform Handler instead of fastcgi. Follow my blogs below for details</p>
<ul>
<li><a href="https://prmadi.com/django-app-with-httpplatformhandler-in-azure-app-services-windows/" target="_blank" rel="noopener">Django app with HttpPlatformHandler in Azure App Services (Windows)</a></li>
<li><a href="https://prmadi.com/running-flask-app-with-httpplatformhandler-in-azure-app-services/" target="_blank" rel="noopener">Running Flask app with HttpPlatformHandler in Azure App Services</a></li>
</ul>
<h4 id="Django"><a href="#Django" class="headerlink" title="Django"></a>Django</h4><p><strong>Sample Project:</strong> I followed instructions in my Django blog listed above to deploy a sample app. Later I have added below two functions to calculate nth Fibonacci number. <a href="https://github.com/prashanthmadi/azure-django-httphandler/commit/7654e83b659b11deb62fdce536bbe5c3009399b5" target="_blank" rel="noopener">Change Commit Info</a></p>
<pre><code>def fibnonci_normal(n):  
    if n == 0:
        return 0
    elif n == 1:
        return 1
    else:
        return fibnonci_normal(n - 1) + fibnonci_normal(n - 2)

def fibnonci_easy(n):  
    return ((1 + sqrt(5))**n - (1 - sqrt(5))**n) / (2**n * sqrt(5))
</code></pre><p>As you can see below, each request takes longer with higher the number of query param. <img src="https://prmadi.com/content/images/2017/06/Capture3.PNG" alt="Fibonacci Output"> With below profilers we would try to find where our web app is spending its time and catch Fibonacci functions we included. 1) <a href="https://github.com/joerick/pyinstrument" target="_blank" rel="noopener">Pyinstrument</a>: <em>A Python profiler that records the call stack of the executing code, instead of just the final function in it</em></p>
<ul>
<li>Install Pyinstrument using pip and create a <code>profiles</code> folder in wwwroot. <img src="https://prmadi.com/content/images/2017/06/Capture4-1.PNG" alt="Install Pyinstrument "></li>
<li><p>Add below two variables to settings.py</p>
<p>PYINSTRUMENT_PROFILE_DIR = ‘profiles’<br>PYINSTRUMENT_USE_SIGNAL = False  </p>
</li>
</ul>
<ul>
<li>Add <code>pyinstrument.middleware.ProfilerMiddleware</code> to MIDDLEWARE_CLASSES</li>
<li>There is a known issue in Pyinstrument while running in newer versions of Django. I have sent a <a href="https://github.com/joerick/pyinstrument/pull/28" target="_blank" rel="noopener">Pull request</a> that should fix this. Meanwhile make these changes manually in <code>D:\home\Python27\Lib\site-packages\pyinstrument\middleware.py</code> file</li>
</ul>
<p>Above changes would write .html files in profiles folder which we created earlier in wwwroot folder <img src="https://prmadi.com/content/images/2017/06/profiler_output.PNG" alt="Profiler Output Files"> Open .html files in your favorite browser and you should see something like below which should help you <img src="https://prmadi.com/content/images/2017/06/profiler_output1.PNG" alt="Profiler Output"> 2) <a href="https://github.com/django-silk/silk" target="_blank" rel="noopener">Silk</a>: <em>A live profiling and inspection tool for the Django framework. Silk intercepts and stores HTTP requests and database queries before presenting them in a user interface for further inspection.</em> Below is the sample screenshot of all the requests I had and time taken for each. None of my url’s were interacting with database so queries show 0ms. <img src="https://prmadi.com/content/images/2017/06/Capture5.PNG" alt="Request Details"> If you click on a request, it would take you to individual request level details and with profiling enabled using decorators it would provide time spent at each function level. <img src="https://prmadi.com/content/images/2017/06/Capture6.PNG" alt="cProfile using Silk"> You can follow steps @ <a href="https://github.com/django-silk/silk" target="_blank" rel="noopener">https://github.com/django-silk/silk</a> to configure it. Their documentation is good and it was really easy. 3) <a href="https://github.com/munhitsu/django-dowser" target="_blank" rel="noopener">django-dowser</a> : This is based on <a href="https://github.com/mgedmin/dozer" target="_blank" rel="noopener">dozer</a> that can be used directly with Django app, except that this module gives you option to filter based on number of objects (<a href="https://github.com/mgedmin/dozer/issues/2" target="_blank" rel="noopener">issue</a> tracking it). you might have to make little changes in original module and use below to install module instead of normal pip install from PyPl</p>
<pre><code>pip install git+git://github.com/munhitsu/django-dowser.git  
</code></pre><p>Other Approaches, I haven’t tried and looks promising</p>
<ul>
<li><a href="https://django-debug-toolbar.readthedocs.io/en/stable/#" target="_blank" rel="noopener">django-debug-toolbar</a></li>
<li><a href="https://github.com/google/pyringe" target="_blank" rel="noopener">pyringe</a> (stale project but liked idea of attaching to process)</li>
<li><a href="https://pypi.python.org/pypi/objgraph" target="_blank" rel="noopener">objgraph</a></li>
<li><a href="https://pythonhosted.org/Pympler/tutorials/muppy_tutorial.html" target="_blank" rel="noopener">Pympler</a></li>
<li><a href="https://www.toofishes.net/blog/using-guppy-debug-django-memory-leaks/" target="_blank" rel="noopener">guppy</a></li>
</ul>
<h4 id="Flask"><a href="#Flask" class="headerlink" title="Flask"></a>Flask</h4><p><a href="http://werkzeug.pocoo.org/docs/0.12/contrib/profiler/" target="_blank" rel="noopener">ProfilerMiddleware</a>: Simple WSGI profiler middleware for finding bottlenecks in Flask web application. Below is my sample Flask App using ProfilerMiddleware. It generates pstat files in profiles folder, later can be visualized using tools like <a href="https://jiffyclub.github.io/snakeviz/" target="_blank" rel="noopener">snakeviz</a>, <a href="http://www.vrplumber.com/programming/runsnakerun/" target="_blank" rel="noopener">runsnakerun</a>.</p>
<pre><code>from flask import Flask  
from werkzeug.contrib.profiler import ProfilerMiddleware

app = Flask(__name__)

@app.route(&quot;/&quot;)
def hello():  
    fibnonci_normal(10)
    return &quot;Hello World!&quot;

def fibnonci_normal(n):  
    if n == 0:
        return 0
    elif n == 1:
        return 1
    else:
        return fibnonci_normal(n - 1) + fibnonci_normal(n - 2)

app = ProfilerMiddleware(app,profile_dir=&quot;profiles&quot;)

if __name__ == &quot;__main__&quot;:  
    app.run()
</code></pre><p>If you remove profile_dir, it would write logs to STDOUT. Check their documentation on details for adding restrictions/sort data. Other Approaches, I haven’t tried and looks promising</p>
<ul>
<li><a href="https://github.com/mgood/flask-debugtoolbar" target="_blank" rel="noopener">flask-debugtoolbar</a></li>
<li><a href="https://github.com/mgedmin/dozer" target="_blank" rel="noopener">dozer</a> (Works for Django too)</li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
	<span class="ico-folder"></span>
    <a class="article-category-link" href="/categories/python/">python</a>

      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

      
            
      
        
	<div id="comment">
		<!-- 来必力City版安装代码 -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTQ4MS82MDQ5">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
		</div>
		<!-- City版安装代码已完成 -->
	</div>


      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/use-jpgrapg-package-with-azure-web-app/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
           Use JpGraph library with Azure Web App		
        
      </div>
    </a>
  
  
    <a href="/running-flask-app-with-httpplatformhandler-in-azure-app-serviceswindows/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"> Running Flask App with HttpPlatformHandler in Azure App Services(Windows)		</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article" style="overflow-y: scroll; max-width: 28%;">
    <strong class="toc-title">Contents</strong>
    
      <ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#Django"><span class="nav-number">1.</span> <span class="nav-text">Django</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Flask"><span class="nav-number">2.</span> <span class="nav-text">Flask</span></a></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2019 Azure OSS Developer Support All Rights Reserved.
          
      </div>
      <div class="site-credit">
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var contentdiv = document.getElementById("content");

    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
</script>

<!-- Custome JS -->
<script src="/js/my.js"></script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.js"></script>


<script src="/js/scripts.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>







  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>








  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
</body>
</html>
